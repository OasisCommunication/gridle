"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define([],t):("undefined"==typeof exports||_typeof(exports),t())}(function(){var s,i,t;return t={convert:function(a,n){return n={},a.on=function(t,e){return(n[t]=n[t]||[]).push(e),a},a.emit=function(t){var e,s,i;if(n[t]){for(e=0,s=(i=n[t]).length;e<s;e++)i[e].apply(a,Array.prototype.slice.call(arguments,1));return a}},a}},window.Gridle={_inited:!1,_isReady:!1,_statesInCss:null,_statesFindedInCss:!1,_cssSettings:[],_states:[],_activeStates:[],_activeStatesNames:[],_inactiveStates:[],_inactiveStatesNames:[],_updatedStates:[],_updatedStatesNames:[],resizeTimeout:null,_settings:{onUpdate:null,debug:null,ignoredStates:[]},init:function(t){var e,s=this;return this._inited=!0,null!=(null!=t?t.ignoredStates:void 0)&&-1<(e=t.ignoredStates.indexOf("default"))&&t.ignoredStates.splice(e,1),t&&(this._settings=this._extend(this._settings,t)),this._debug("waiting for content to be fully loaded"),i(function(){return s._parseCss()})},_extend:function(t,e){var s,i;for(s in e)i=e[s],t[s]=i;return t},_parseCss:function(){var e,t,s,i,a,n,u,r;if(!this._statesFindedInCss){for(t=0,i=document.styleSheets.length,r=!1;t<i;){try{if("string"==typeof(n=document.styleSheets[t].cssText||document.styleSheets[t].cssRules||document.styleSheets[t].rules))(u=n.match(/#gridle-settings(?:\s*)\{(?:\s*)content(?:\s*):(?:\s*)\"(.+)\"(;\s*|\s*)\}/)&&RegExp.$1)&&(u=u.toString().replace(/\\/g,""),u=JSON.parse(u),this._cssSettings=u,r=!0,this._cssSettings=u,this._statesInCss=u.states);else for(s in n)a=n[s],/#gridle-settings/.test(a.cssText)&&(u=(u=(u=(u=(u=a.cssText.toString().match(/:(.*);/)&&RegExp.$1).toString().replace(/\\/g,"")).trim()).substr(1)).substr(0,u.length-1),null!=(null!=(u=JSON.parse(u))?u.states:void 0))&&(this._cssSettings=u,this._statesInCss=u.states,r=!0)}catch(t){if("SecurityError"!==(e=t).name)throw e}t++}return this._statesFindedInCss=r,this._statesInCss?this._processFindedStates():this._debug("no states found...")}},_processFindedStates:function(){var t,e,s;for(t in this._debug("begin process finded states in css"),s=this._statesInCss)e=s[t],-1===this._settings.ignoredStates.indexOf(t)&&this._registerState(t,e);return this._launch()},_launch:function(){var t,e=this;return t=!this._isReady,this._debug("launch"),this._isReady=!0,t&&this._crossEmit("ready"),this._addEvent(window,"resize",function(t){return clearTimeout(e.resizeTimeout),e.resizeTimeout=setTimeout(function(){return e._onResize()},100)}),this._onResize()},_onResize:function(){if([],this._updateStatesStatus(),this.getActiveStatesNames().length&&this._debug("active states",this.getActiveStatesNames().join(",")),this.getInactiveStatesNames().length&&this._debug("inactive states",this.getInactiveStatesNames().join(",")),this.getUpdatedStatesNames().length)return this._debug("updated states",this.getUpdatedStatesNames().join(","))},_registerState:function(t,e,s){var i;return i={name:t,query:e.query,settings:e,status:null,previous_status:null,updateOnResize:null==s||s},this._states.push(i),this._debug("|--- register state",t,i)},_updateStatesStatus:function(){var t,e,s,i,a,n;for(s in t=this.getDefaultState(),e=this._states.indexOf(t),n=t.status,this._activeStates=[],this._activeStatesNames=[],this._inactiveStates=[],this._inactiveStatesNames=[],this._updatedStates=[],this._updatedStatesNames=[],i=this._states)(a=i[s]).updateOnResize&&(this._states[s].previous_status=a.status,this._validateState(a)?(this._states[s].status||(this._updatedStates.push(a),this._updatedStatesNames.push(a.name)),this._states[s].status=!0,this._activeStates.push(a),this._activeStatesNames.push(a.name)):"default"!==a.name&&(this._states[s].status&&(this._updatedStates.push(a),this._updatedStatesNames.push(a.name)),this._states[s].status=!1,this._inactiveStates.push(a),this._inactiveStatesNames.push(a.name)));if(this._activeStates.length?(this._states[e].status=!1,this._inactiveStates.push(t),this._inactiveStatesNames.push("default"),n&&(this._updatedStates.push(t),this._updatedStatesNames.push("default"))):(this._states[e].status=!0,this._activeStates.push(t),this._activeStatesNames.push("default"),n||(this._updatedStates.push(t),this._updatedStatesNames.push("default"))),this._updatedStates.length&&this._crossEmit("update",this._updatedStates,this._activeStates,this._inactiveStates),this._updatedStates.length&&this._settings.onUpdate)return this._settings.onUpdate(this._updatedStates,this._activeStates,this._inactiveStates)},_validateState:function(t){return matchMedia(t.query).matches},_addEvent:function(t,e,s){return!!t&&(t.addEventListener?t.addEventListener(e,s,!1):t.attachEvent?t.attachEvent("on"+e,s):t["on"+e]=s)},_crossEmit:function(t){return"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery(this).trigger(t,Array.prototype.slice.call(arguments,1)),jQuery("body").trigger("gridle."+t,Array.prototype.slice.call(arguments,1))),this.emit.apply(this,arguments)},_ajax:function(t){var e,s;return e={type:t.type||"GET",url:t.url,success:t.success,error:t.error,dataType:t.dataType||"text",context:t.context},s=new XMLHttpRequest,e.context&&(s.context=e.context),s.open(e.type,e.url,!0),s.onreadystatechange=function(){var t;if(4!==s.readyState)return!1;switch(s.status){case 200:switch(e.dataType){case"json":t=JSON.parse(s.responseText);break;default:t=s.responseText}if(e.success)return e.success(t,s.status,s)}},s.send()},getDefaultState:function(){var t,e,s,i;for(t=0,e=(s=this.getRegisteredStates()).length;t<e;t++)if("default"===(i=s[t]).name)return i},getRegisteredStates:function(){return this._states},getUpdatedStates:function(){return this._updatedStates},getUpdatedStatesNames:function(){return this._updatedStatesNames},getActiveStates:function(){return this._activeStates},getActiveStatesNames:function(){return this._activeStatesNames},getInactiveStates:function(){return this._inactiveStates},getInactiveStatesNames:function(){return this._inactiveStatesNames},isActive:function(t){var e,s,i;for(e in s=!1,i=this._activeStatesNames)t===i[e]&&(s=!0);return s},isReady:function(){return this._isReady},_debug:function(){if(this._settings.debug)return console.log("GRIDLE",arguments)}},s=!1,i=function(t){var e;return e=function(t){if(s)t();else{if("complete"===document.readyState)return s=!0,void t();if(document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){s=!0,t()},!1),/KHTML|WebKit|iCab/i.test(navigator.userAgent))var e=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(s=!0,t(),clearInterval(e))},10);window.onload=function(){s=!0,t()}}},window.addEventListener?window.addEventListener("load",function(){return s=!0,t()},!1):window.attachEvent("onload",function(){return s=!0,t()}),e(function(){return t()})},t.convert(window.Gridle),i(function(){return setTimeout(function(){if(!Gridle._inited)return Gridle.init()},500)}),Gridle});